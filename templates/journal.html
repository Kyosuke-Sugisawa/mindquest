{% extends "base.html" %}

{% block title %}日記を書く{% endblock %}

{% block content %}
<div class="container">
    <h1>📝 日記を書く</h1>

    <form method="POST" action="/journal">
        <textarea name="content" rows="8" cols="50" placeholder="今日感じたことや考えたことを書いてみよう..." required></textarea><br>
        <button type="submit">保存する</button>
    </form>

    <form method="POST" action="/journal/analyze">
        <button type="submit" style="margin-top: 1em;">🧠 AIに分析してもらう</button>
    </form>

    {% if analysis %}
    <div style="margin-top: 2em; background: #f7f7f7; padding: 1em; border-radius: 8px;">
        <h3>🧠 AIからのコメント</h3>
        <p>{{ analysis }}</p>
    </div>
    {% endif %}

    <h2 style="margin-top: 2em;">🗂 過去の日記</h2>
    <ul>
        {% for entry in entries %}
        <li>
            <strong>{{ entry.created_at }}</strong><br>
            {{ entry.content|e }}<br>
            {% if entry.feedback %}
                <div style="margin-top: 0.5em; background: #eef; padding: 0.5em; border-radius: 5px;">
                    <em>🧠 AIコメント：</em> {{ entry.feedback }}
                </div>
            {% endif %}
            <form method="POST" action="/journal/delete" style="display:inline;">
                <input type="hidden" name="entry_id" value="{{ entry.id }}">
                <button type="submit" style="font-size: 0.8em; color: red; border: none; background: none; cursor: pointer;">🗑️ 削除</button>
            </form>
        </li>
        {% endfor %}
    </ul>
</div>
{% endblock %}
